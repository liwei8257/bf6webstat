# ğŸš€ BF6ç©å®¶æ•°æ®ç»Ÿè®¡ç³»ç»Ÿ - éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•
- [æœåŠ¡å™¨éƒ¨ç½²æ–¹æ¡ˆ](#æœåŠ¡å™¨éƒ¨ç½²æ–¹æ¡ˆ)
- [Linuxéƒ¨ç½²è¯¦ç»†æ­¥éª¤](#linuxéƒ¨ç½²è¯¦ç»†æ­¥éª¤)
- [Dockeréƒ¨ç½²](#dockeréƒ¨ç½²)
- [WindowsæœåŠ¡å™¨éƒ¨ç½²](#windowsæœåŠ¡å™¨éƒ¨ç½²)
- [å®‰å…¨å»ºè®®](#å®‰å…¨å»ºè®®)

---

## ğŸŒ æœåŠ¡å™¨éƒ¨ç½²æ–¹æ¡ˆ

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| **Gunicorn + Nginx** | æ€§èƒ½å¥½ã€ç¨³å®š | LinuxæœåŠ¡å™¨ï¼ˆæ¨èï¼‰|
| **Docker** | æ˜“éƒ¨ç½²ã€éš”ç¦»å¥½ | ä»»ä½•æ”¯æŒDockerçš„ç¯å¢ƒ |
| **äº‘å¹³å°PaaS** | å…è¿ç»´ã€è‡ªåŠ¨æ‰©å±• | Railway/Render/Heroku |
| **Windows IIS** | WindowsåŸç”Ÿæ”¯æŒ | Windows Server |

---

## ğŸ§ Linuxéƒ¨ç½²è¯¦ç»†æ­¥éª¤

### 1. å‡†å¤‡æœåŠ¡å™¨

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…Python 3.8+
sudo apt install python3 python3-pip python3-venv -y

# å®‰è£…Nginx
sudo apt install nginx -y
```

### 2. ä¸Šä¼ é¡¹ç›®æ–‡ä»¶

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www/bf6stat
cd /var/www/bf6stat

# ä¸Šä¼ æ‰€æœ‰é¡¹ç›®æ–‡ä»¶
# å¯ä»¥ä½¿ç”¨ scp, rsync æˆ– git clone
git clone <your-repo-url> .
# æˆ–è€…
scp -r ./* user@server:/var/www/bf6stat/
```

### 3. é…ç½®Pythonç¯å¢ƒ

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è®¾ç½®ç¯å¢ƒå˜é‡
export FLASK_ENV=production
export SECRET_KEY=$(python3 -c "import secrets; print(secrets.token_hex(32))")
```

### 4. åˆ›å»ºsystemdæœåŠ¡

åˆ›å»ºæ–‡ä»¶ `/etc/systemd/system/bf6stat.service`:

```ini
[Unit]
Description=BF6 Stats Web Application
After=network.target

[Service]
Type=notify
User=www-data
Group=www-data
WorkingDirectory=/var/www/bf6stat
Environment="FLASK_ENV=production"
Environment="SECRET_KEY=your-secret-key-here"
ExecStart=/var/www/bf6stat/venv/bin/gunicorn \
    --workers 4 \
    --bind 127.0.0.1:8000 \
    --timeout 120 \
    --access-logfile /var/log/bf6stat/access.log \
    --error-logfile /var/log/bf6stat/error.log \
    wsgi:app

Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
# åˆ›å»ºæ—¥å¿—ç›®å½•
sudo mkdir -p /var/log/bf6stat
sudo chown www-data:www-data /var/log/bf6stat

# è®¾ç½®æƒé™
sudo chown -R www-data:www-data /var/www/bf6stat

# å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl start bf6stat
sudo systemctl enable bf6stat

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status bf6stat
```

### 5. é…ç½®Nginxåå‘ä»£ç†

åˆ›å»ºæ–‡ä»¶ `/etc/nginx/sites-available/bf6stat`:

```nginx
server {
    listen 80;
    server_name your-domain.com;  # æ”¹æˆä½ çš„åŸŸå

    # é™æ€æ–‡ä»¶
    location /static {
        alias /var/www/bf6stat/static;
        expires 30d;
    }

    # ä»£ç†åˆ°Gunicorn
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 120s;
        proxy_send_timeout 120s;
        proxy_read_timeout 120s;
    }
}
```

```bash
# å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/bf6stat /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
```

### 6. é…ç½®SSLï¼ˆHTTPSï¼‰- å¯é€‰ä½†æ¨è

```bash
# å®‰è£…Certbot
sudo apt install certbot python3-certbot-nginx -y

# è·å–SSLè¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

---

## ğŸ³ Dockeréƒ¨ç½²

### 1. åˆ›å»ºDockerfile

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# å®‰è£…ä¾èµ–
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 5000

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV FLASK_ENV=production

# å¯åŠ¨å‘½ä»¤
CMD ["gunicorn", "--bind", "0.0.0.0:5000", "--workers", "4", "--timeout", "120", "wsgi:app"]
```

### 2. åˆ›å»ºdocker-compose.yml

```yaml
version: '3.8'

services:
  web:
    build: .
    ports:
      - "8000:5000"
    environment:
      - FLASK_ENV=production
      - SECRET_KEY=${SECRET_KEY}
      - TRN_API_KEY=${TRN_API_KEY}
    volumes:
      - ./players.json:/app/players.json
    restart: unless-stopped
```

### 3. éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker-compose build

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

---

## ğŸ’» WindowsæœåŠ¡å™¨éƒ¨ç½²

### ä½¿ç”¨waitressï¼ˆæ¨èï¼‰

```bash
# å®‰è£…waitress
pip install waitress

# åˆ›å»ºå¯åŠ¨è„šæœ¬ run_production.py
```

åˆ›å»º `run_production.py`:

```python
from waitress import serve
from app import app
import os

os.environ['FLASK_ENV'] = 'production'

if __name__ == '__main__':
    print("ğŸš€ BF6ç©å®¶æ•°æ®ç»Ÿè®¡ç³»ç»Ÿå¯åŠ¨ä¸­...")
    print("ğŸ“Š è®¿é—®: http://0.0.0.0:8080")
    serve(app, host='0.0.0.0', port=8080, threads=4)
```

```bash
# è¿è¡Œ
python run_production.py
```

### ä½¿ç”¨NSSMåˆ›å»ºWindowsæœåŠ¡

```bash
# ä¸‹è½½NSSM: https://nssm.cc/download
# å®‰è£…æœåŠ¡
nssm install BF6Stats "C:\Python311\python.exe" "C:\bf6stat\run_production.py"

# å¯åŠ¨æœåŠ¡
nssm start BF6Stats
```

---

## â˜ï¸ äº‘å¹³å°éƒ¨ç½²ï¼ˆæœ€ç®€å•ï¼‰

### Railwayéƒ¨ç½²

1. è®¿é—® [railway.app](https://railway.app)
2. è¿æ¥GitHubä»“åº“
3. æ·»åŠ ç¯å¢ƒå˜é‡ï¼š`FLASK_ENV=production`
4. è‡ªåŠ¨éƒ¨ç½²å®Œæˆ

### Renderéƒ¨ç½²

1. è®¿é—® [render.com](https://render.com)
2. åˆ›å»ºWeb Service
3. è¿æ¥Gitä»“åº“
4. è®¾ç½®å¯åŠ¨å‘½ä»¤ï¼š`gunicorn wsgi:app`
5. è‡ªåŠ¨éƒ¨ç½²

---

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆä¸è¦æäº¤åˆ°Gitï¼‰ï¼š

```bash
FLASK_ENV=production
SECRET_KEY=your-random-secret-key-here
TRN_API_KEY=your-tracker-api-key
```

### 2. é˜²ç«å¢™é…ç½®

```bash
# Ubuntu/Debian
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

### 3. é™åˆ¶è®¿é—®ï¼ˆå¯é€‰ï¼‰

åœ¨Nginxé…ç½®ä¸­æ·»åŠ ï¼š

```nginx
# IPç™½åå•
allow 1.2.3.4;
deny all;

# æˆ–åŸºæœ¬è®¤è¯
auth_basic "Restricted Access";
auth_basic_user_file /etc/nginx/.htpasswd;
```

### 4. å®šæœŸæ›´æ–°

```bash
# è‡ªåŠ¨æ›´æ–°è„šæœ¬
cd /var/www/bf6stat
git pull
source venv/bin/activate
pip install -r requirements.txt
sudo systemctl restart bf6stat
```

---

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–

### 1. Gunicornå·¥ä½œè¿›ç¨‹æ•°

```bash
# æ¨èï¼š(2 Ã— CPUæ ¸å¿ƒæ•°) + 1
# 4æ ¸CPU: --workers 9
```

### 2. Nginxç¼“å­˜

```nginx
# æ·»åŠ åˆ°nginxé…ç½®
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=bf6cache:10m max_size=100m;
proxy_cache bf6cache;
proxy_cache_valid 200 30s;
```

### 3. Redisç¼“å­˜ï¼ˆé«˜çº§ï¼‰

å¦‚æœéœ€è¦æ›´å¥½çš„ç¼“å­˜æ€§èƒ½ï¼Œå¯ä»¥é›†æˆRedisï¼š

```bash
pip install redis flask-caching
```

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æŸ¥çœ‹æ—¥å¿—

```bash
# systemdæœåŠ¡æ—¥å¿—
sudo journalctl -u bf6stat -f

# Nginxè®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/access.log

# åº”ç”¨æ—¥å¿—
sudo tail -f /var/log/bf6stat/access.log
```

### ç›‘æ§å·¥å…·æ¨è

- **Uptime Kuma**: å…è´¹å¼€æºç›‘æ§
- **UptimeRobot**: å…è´¹å¤–ç½‘ç›‘æ§
- **Prometheus + Grafana**: ä¸“ä¸šç›‘æ§æ–¹æ¡ˆ

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### ç«¯å£è¢«å ç”¨
```bash
sudo lsof -i :8000
sudo kill -9 <PID>
```

### æƒé™é—®é¢˜
```bash
sudo chown -R www-data:www-data /var/www/bf6stat
sudo chmod -R 755 /var/www/bf6stat
```

### é‡å¯æœåŠ¡
```bash
sudo systemctl restart bf6stat
sudo systemctl restart nginx
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœéƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶
2. ç¡®è®¤é˜²ç«å¢™è®¾ç½®
3. éªŒè¯ç¯å¢ƒå˜é‡
4. æµ‹è¯•ç½‘ç»œè¿æ¥

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸ‰

